# Установка и настройка Prometheus

## 7 Пара
## 1 Задание: Установка и настройка Prometheus

## Содержание

1. [Проверка и отключение/настройка файервола](#1-проверка-и-отключениенастройка-файервола)
2. [Установка необходимых пакетов (wget, curl, git, tar)](#2-установка-необходимых-пакетов-wget-curl-git-tar)
3. [Установка и настройка Chrony для синхронизации времени](#3-установка-и-настройка-chrony-для-синхронизации-времени)
4. [Проверка и отключение SELinux](#4-проверка-и-отключение-selinux)
5. [Скачивание Prometheus](#5-скачивание-prometheus)
6. [Создание каталогов для Prometheus](#6-создание-каталогов-для-prometheus)
7. [Разархивация скачанного файла](#7-разархивация-скачанного-файла)
8. [Переход в распакованную директорию](#8-переход-в-распакованную-директорию)
9. [Проверка текущей директории](#9-проверка-текущей-директории)
10. [Копирование файлов Prometheus в системные директории](#10-копирование-файлов-prometheus-в-системные-директории)
11. [Очистка временных файлов](#11-очистка-временных-файлов)
12. [Повторная проверка текущей директории](#12-повторная-проверка-текущей-директории)
13. [Проверка содержимого директории](#13-проверка-содержимого-директории)

---

## 1. Проверка и отключение/настройка файервола

```bash
# Проверить статус файервола
sudo firewall-cmd --state

# Отключить файервол, если он включен
sudo systemctl stop firewalld
sudo systemctl disable firewalld
```

**Описание:**
- `firewall-cmd --state`: Проверяет текущий статус файервола (включен или выключен).
- `systemctl stop firewalld`: Останавливает службу файервола.
- `systemctl disable firewalld`: Отключает автозапуск файервола при загрузке системы.

---

## 2. Установка необходимых пакетов (wget, curl, git, tar)

```bash
# Установка wget, curl, git и tar
sudo yum install -y wget curl git tar
```

**Описание:**
- `yum install -y`: Устанавливает указанные пакеты (`wget`, `curl`, `git`, `tar`) без запроса подтверждения.
- Эти инструменты необходимы для скачивания файлов, работы с Git и распаковки архивов.

---

## 3. Установка и настройка Chrony для синхронизации времени

```bash
# Установка Chrony
sudo yum install -y chrony

# Включение и запуск службы
sudo systemctl enable chronyd
sudo systemctl start chronyd

# Проверка состояния службы
systemctl status chronyd
```

**Описание:**
- `yum install -y chrony`: Устанавливает Chrony — демон для синхронизации времени.
- `systemctl enable chronyd`: Добавляет службу Chrony в автозагрузку.
- `systemctl start chronyd`: Запускает службу Chrony.
- `systemctl status chronyd`: Проверяет статус службы (работает ли она корректно).

---

## 4. Проверка и отключение SELinux

```bash
# Проверка статуса SELinux
getenforce

# Если выводится "Enforcing", отключаем SELinux:
sudo setenforce 0
sudo sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config

# Если команда getenforce недоступна, SELinux не установлен.
```

**Описание:**
- `getenforce`: Проверяет текущий режим работы SELinux (`Enforcing`, `Permissive` или `Disabled`).
- `setenforce 0`: Переключает SELinux в режим `Permissive` (временно отключает защиту).
- `sed -i`: Изменяет конфигурационный файл SELinux, чтобы полностью отключить его при следующей загрузке.

---

## 5. Скачивание Prometheus

```bash
# Скачивание версии 3.3.0
wget https://github.com/prometheus/prometheus/releases/download/v3.3.0/prometheus-3.3.0.linux-amd64.tar.gz
```

**Описание:**
- `wget`: Скачивает архив с официального репозитория Prometheus с указанным URL.

---

## 6. Создание каталогов для Prometheus

```bash
# Создание директорий
sudo mkdir -p /etc/prometheus /var/lib/prometheus
```

**Описание:**
- `mkdir -p`: Создает необходимые директории для конфигурации и данных Prometheus. Флаг `-p` позволяет создавать родительские директории, если они отсутствуют.

---

## 7. Разархивация скачанного файла

```bash
# Распаковка архива
tar -zxf prometheus-*.linux-amd64.tar.gz
```

**Описание:**
- `tar -zxf`: Распаковывает `.tar.gz` архив в текущую директорию. Флаги:
  - `-z`: Использует gzip для распаковки.
  - `-x`: Извлекает файлы.
  - `-f`: Указывает имя файла.

---

## 8. Переход в распакованную директорию

```bash
# Переход в папку
cd prometheus-*.linux-amd64
```

**Описание:**
- `cd`: Переходит в указанную директорию (распакованный архив Prometheus).

---

## 9. Проверка текущей директории

```bash
# Проверка текущего пути
pwd
```

**Описание:**
- `pwd`: Выводит полный путь к текущей рабочей директории.

---

## 10. Копирование файлов Prometheus в системные директории

```bash
# Копирование бинарных файлов
sudo cp prometheus promtool /usr/local/bin/

# Копирование конфигурационного файла
sudo cp prometheus.yml /etc/prometheus/
```

**Описание:**
- `cp`: Копирует файлы в системные директории.
  - Бинарные файлы (`prometheus`, `promtool`) помещаются в `/usr/local/bin/` для глобального доступа.
  - Конфигурационный файл (`prometheus.yml`) копируется в `/etc/prometheus/`.

---

## 11. Очистка временных файлов

```bash
# Выход из директории и удаление временных файлов
cd .. && rm -rf prometheus-*.linux-amd64/ && rm -f prometheus-*.linux-amd64.tar.gz
```

**Описание:**
- `cd ..`: Возвращает в родительскую директорию.
- `rm -rf`: Рекурсивно удаляет директорию с распакованными файлами.
- `rm -f`: Удаляет скачанный архив.

---

## 12. Повторная проверка текущей директории

```bash
# Проверка текущего пути
pwd
```

**Описание:**
- `pwd`: Подтверждает, что вы вернулись в правильную директорию после очистки.

---

## 13. Проверка содержимого директории

```bash
# Просмотр содержимого текущей директории
ls -l
```

**Описание:**
- `ls -l`: Выводит список файлов и директорий в текущей директории с подробной информацией (права доступа, владелец, размер и т.д.).

---

